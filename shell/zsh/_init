#!/usr/bin/env zsh
source ${0:A:h}/../../deploy
source $DOTTY_CONFIG_HOME/shell/zsh/.zshenv

install() {
  # Base utilities
  brew install zsh bash wget git curl tree ssh rsync p7zip jq direnv

  # Other utilities
  brew install shfmt zshdb bashdb procs dust shellcheck neofetch mosh \
    sd duf

  # Macos uses different trash app
  case $(_os) in
    macos) brew install trash ;;
    linux-*) brew install trash-cli ;;
  esac

  # True color and Italic support https://github.com/syl20bnr/spacemacs/wiki/Terminal
  /usr/bin/tic -x -o ~/.terminfo $DOTTY_CONFIG_HOME/shell/zsh/xterm-24bit.terminfo

  # Set default shell to zsh
  chsh -s $(which zsh) $(whoami)

  # alternative for Linux `sudo usermod -s /usr/bin/zsh <username>`

  local zsh="$(which zsh)"
  grep $zsh /etc/shells &>/dev/null || sudo tee -a /etc/shells <<<$zsh
}

update() {
  zinit self-update
  zinit update --parallel
}

link() {
  rm -rf ~/.zinit/snippets/*.config--*--config--shell--zsh
  rm -f ~/.profile
  mklink $DOTTY_CONFIG_HOME/shell/zsh/.zsh* ~/
  mklink $DOTTY_CONFIG_HOME/shell/zsh/config/* $XDG_CONFIG_HOME/

  # Create wgetrc
  [[ ! -f $WGETRC ]] && touch $WGETRC
}

clean() {
  rm -f ~/.zshrc
  rm -f ~/.zshenv
  rm -f $XDG_CONFIG_HOME/starship.toml
}

init "$@"
