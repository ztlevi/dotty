#!/usr/bin/env zsh
source ${0:A:h}/../../deploy
GIT_DIR="$XDG_CONFIG_HOME/git"

install() {
  brew install git libressl openssl git-lfs gh git-secrets diff-so-fancy git-extras git-flow-avh
  case $(_os) in
    macos)
      brew tap microsoft/git
      brew install --cask git-credential-manager-core
      ;;
    linux-*)
      local tempdir=/tmp/temp-install
      mkdir -p $tempdir
      (
        cd $tempdir
        wget --no-check-certificate \
          $(get_github_latest_release_url GitCredentialManager/git-credential-manager .*linux.*\.tar\.gz) -O gcm.tar.gz
        sudo tar -xvf gcm.tar.gz -C /usr/local/bin
        rm -f gcm.tar.gz
      )
      ;;
  esac

  echo-info "Setup git using following command:"
  head -n 16 ${0:A:h}/README.md
}

# update() {}

link() {
  # Check all the rules with `git config --list --show-origin`
  rm -fv ~/.gitconfig $GIT_DIR/config /usr/local/etc/gitconfig
  mklink $DOTTY_CONFIG_HOME/shell/git/config $GIT_DIR/
  mklink $DOTTY_CONFIG_HOME/shell/git/attributes $GIT_DIR/
  mklink $DOTTY_CONFIG_HOME/shell/git/ignore $GIT_DIR/
  mklink $DOTTY_CONFIG_HOME/shell/git/.ignore ~/
}

clean() {
  rm -rf $GIT_DIR
}

init "$@"
