#!/usr/bin/env zsh
source ${0:A:h}/../../deploy

_install_pip_packages() {
  PIP3_INSTALL pip setuptools poetry

  # Other packages
  PIP3_INSTALL black debugpy pdbpp pylint autoflake gnureadline grip cpplint
}

install() {
  # pyenv on Ubuntu seem to has some problem, use native installation on Ubuntu
  case $(_os) in
    linux-debian) APT_INSTALL python3.8 ;;
  esac

  brew install pyenv

  pyenv install $PYTHON_VERSION
  pyenv global $PYTHON_VERSION

  # temp add pyenv shims path, `pyenv init` is inside aliases.zsh
  path=($PYENV_ROOT/shims $path)

  _install_pip_packages
  # Run rehash everytime install global package
  pyenv rehash
}

update() {
  _install_pip_packages
}

link() {
  mklink $DOTTY_CONFIG_HOME/dev/python/config/flake8 $XDG_CONFIG_HOME/
  mklink $DOTTY_CONFIG_HOME/dev/python/config/pudb/pudb.cfg $XDG_CONFIG_HOME/pudb/
  mklink $DOTTY_CONFIG_HOME/dev/python/.* ~/
}

clean() {
  rm -rf $XDG_CONFIG_HOME/flake8 $XDG_CONFIG_HOME/pudb
  rm -rf $PYENV_ROOT
  rm -f $XDG_CACHE_HOME/${SHELL##*/}/pyenv
}

init "$@"
